<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargar Historial Completo - Uber Moto Tracker</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #0f172a;
            color: #f1f5f9;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        .container {
            background: #1e293b;
            padding: 2rem;
            border-radius: 16px;
            border: 2px solid #334155;
        }
        h1 {
            color: #fb923c;
            margin-bottom: 1.5rem;
        }
        .info {
            background: #334155;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.85rem;
        }
        th, td {
            padding: 0.5rem;
            text-align: left;
            border-bottom: 1px solid #334155;
        }
        th {
            color: #fb923c;
            font-weight: 700;
        }
        .btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #fb923c, #f97316);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 1rem;
        }
        .btn:hover {
            opacity: 0.9;
        }
        .success {
            background: #4ade80;
            color: #0f172a;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            display: none;
            font-weight: 700;
        }
        .summary {
            background: #0f172a;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèçÔ∏è Cargar Historial Completo Febrero 2026</h1>
        
        <div class="info">
            <strong>üìä Resumen del mes hasta hoy:</strong>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Recaudaci√≥n</th>
                    <th>Combustible</th>
                    <th>Gastos Moto</th>
                    <th>Ganancia Neta</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>06/02</td>
                    <td>$8,101</td>
                    <td>$5,000</td>
                    <td>$2,179</td>
                    <td>$922</td>
                </tr>
                <tr>
                    <td>07/02</td>
                    <td>$41,245</td>
                    <td>$5,000</td>
                    <td>$5,000</td>
                    <td>$31,245</td>
                </tr>
                <tr>
                    <td>08/02</td>
                    <td>$28,019</td>
                    <td>$5,000</td>
                    <td>$0</td>
                    <td>$23,019</td>
                </tr>
                <tr>
                    <td>09/02</td>
                    <td>$32,051</td>
                    <td>$8,000</td>
                    <td>$3,000</td>
                    <td>$21,051</td>
                </tr>
                <tr>
                    <td>10/02</td>
                    <td>$40,375</td>
                    <td>$0</td>
                    <td>$13,500</td>
                    <td>$26,875</td>
                </tr>
                <tr>
                    <td>11/02</td>
                    <td>$13,839</td>
                    <td>$11,068</td>
                    <td>$21,230</td>
                    <td>-$18,459</td>
                </tr>
                <tr>
                    <td>12/02</td>
                    <td>$34,652</td>
                    <td>$0</td>
                    <td>$8,326</td>
                    <td>$26,326</td>
                </tr>
                <tr>
                    <td>13/02</td>
                    <td>$28,652</td>
                    <td>$0</td>
                    <td>$4,600</td>
                    <td>$24,052</td>
                </tr>
                <tr>
                    <td>14/02</td>
                    <td>$28,156</td>
                    <td>$13,182</td>
                    <td>$2,000</td>
                    <td>$12,974</td>
                </tr>
                <tr>
                    <td>15/02</td>
                    <td>$27,931</td>
                    <td>$0</td>
                    <td>$0</td>
                    <td>$27,931</td>
                </tr>
                <tr>
                    <td>16/02</td>
                    <td>$25,186</td>
                    <td>$0</td>
                    <td>$4,500</td>
                    <td>$3,486</td>
                </tr>
                <tr style="border-top: 2px solid #fb923c; font-weight: 700;">
                    <td><strong>TOTAL</strong></td>
                    <td style="color: #4ade80;"><strong>$308,207</strong></td>
                    <td style="color: #fb923c;"><strong>$47,250</strong></td>
                    <td style="color: #60a5fa;"><strong>$64,335</strong></td>
                    <td style="color: #4ade80;"><strong>$179,422</strong></td>
                </tr>
            </tbody>
        </table>

        <div class="summary">
            <div class="summary-item">
                <span>üìä Recaudaci√≥n Total:</span>
                <span style="color: #4ade80; font-weight: 700;">$308,207</span>
            </div>
            <div class="summary-item">
                <span>‚õΩ Combustible Total:</span>
                <span style="color: #fb923c;">-$47,250</span>
            </div>
            <div class="summary-item">
                <span>üîß Gastos Moto Total:</span>
                <span style="color: #60a5fa;">-$64,335</span>
            </div>
            <div class="summary-item">
                <span>üçî Gastos Personales Total:</span>
                <span style="color: #a78bfa;">-$81,915</span>
            </div>
            <div class="summary-item" style="padding-top: 0.5rem; border-top: 1px solid #334155; margin-top: 0.5rem;">
                <span><strong>üí∞ Ganancia Operativa:</strong></span>
                <span style="color: #4ade80; font-weight: 700;"><strong>$196,622</strong></span>
            </div>
            <div class="summary-item">
                <span>üè¶ Cuota Moto:</span>
                <span style="color: #f87171;">-$475,648</span>
            </div>
            <div class="summary-item" style="padding-top: 0.5rem; border-top: 1px solid #334155; margin-top: 0.5rem;">
                <span><strong>üíµ Disponible Real:</strong></span>
                <span style="color: #f87171; font-weight: 700;"><strong>-$270,378</strong></span>
            </div>
        </div>

        <div class="info">
            <strong>üìù Notas:</strong><br>
            ‚Ä¢ Gastos personales ($81,915) se devolver√°n con salario formal<br>
            ‚Ä¢ Jornada del 16/02 cerrada correctamente con recaudaci√≥n $25,186<br>
            ‚Ä¢ Jornada de HOY (17/02) arranca con: NX $111,639 | MP $29,431 | Efectivo $24,100 | UW $987<br>
            ‚Ä¢ Combustible de hoy ($12,000) ya registrado como gasto pagado desde MP ‚Üí MP queda en $17,431<br>
            ‚Ä¢ Contador Uber actual: $2,097 (en curso)<br>
            ‚Ä¢ KM no disponibles para d√≠as 06-14 (se estimar√°n 80 km promedio por d√≠a)
        </div>

        <button class="btn" style="background: linear-gradient(135deg, #f87171, #ef4444); margin-bottom: 0.5rem;" onclick="if(confirm('¬øLimpiar datos anteriores y recargar historial?')){localStorage.clear(); loadData();}">üóëÔ∏è Limpiar Todo y Cargar Historial</button>
        <button class="btn" onclick="loadData()">Cargar Todo el Historial en la App</button>
        
        <div class="success" id="successMsg">
            ‚úÖ ¬°Historial completo cargado exitosamente!<br>
            Cierra esta pesta√±a y recarga la app principal.
        </div>
    </div>

    <script>
        // Datos hist√≥ricos completos
        const journeysData = [
            {
                date: '2026-02-06',
                km: 80,
                recaudacion: 8101,
                combustible: 5000,
                gastosMoto: 2179,
                gastosPersonales: 3500
            },
            {
                date: '2026-02-07',
                km: 85,
                recaudacion: 41245,
                combustible: 5000,
                gastosMoto: 5000,
                gastosPersonales: 8000
            },
            {
                date: '2026-02-08',
                km: 75,
                recaudacion: 28019,
                combustible: 5000,
                gastosMoto: 0,
                gastosPersonales: 6000
            },
            {
                date: '2026-02-09',
                km: 82,
                recaudacion: 32051,
                combustible: 8000,
                gastosMoto: 3000,
                gastosPersonales: 5500
            },
            {
                date: '2026-02-10',
                km: 90,
                recaudacion: 40375,
                combustible: 0,
                gastosMoto: 13500,
                gastosPersonales: 9000
            },
            {
                date: '2026-02-11',
                km: 70,
                recaudacion: 13839,
                combustible: 11068,
                gastosMoto: 21230,
                gastosPersonales: 4000
            },
            {
                date: '2026-02-12',
                km: 88,
                recaudacion: 34652,
                combustible: 0,
                gastosMoto: 8326,
                gastosPersonales: 7215
            },
            {
                date: '2026-02-13',
                km: 78,
                recaudacion: 28652,
                combustible: 0,
                gastosMoto: 4600,
                gastosPersonales: 7000
            },
            {
                date: '2026-02-14',
                km: 75,
                recaudacion: 28156,
                combustible: 13182,
                gastosMoto: 2000,
                gastosPersonales: 14500
            },
            {
                date: '2026-02-15',
                km: 88,
                kmStart: 3990,
                kmEnd: 4078,
                recaudacion: 27931,
                combustible: 0,
                gastosMoto: 0,
                gastosPersonales: 0,
                startWallets: { nx: 103664, cash: 5600, uber: 27325 },
                endWallets: { nx: 114489, cash: 20600, uber: 29431 },
                ingresoUWaMP: 29431
            },
            {
                date: '2026-02-16',
                kmStart: 4078,
                kmEnd: 4188,
                km: 110,
                recaudacion: 25186,
                combustible: 0,
                gastosMoto: 0,
                gastosPersonales: 0,
                startWallets: { nx: 114489, cash: 20600, uber: 0 },
                endWallets:   { nx: 111639, cash: 24100, uber: 987 },
                gastosDetalle: [
                    { type: "moto",     amount: 4500,  concept: "Aromatizante casco", paymentCash: 4500,  paymentTransfer: 0     },
                    { type: "personal", amount: 14000, concept: "Comida",             paymentCash: 0,     paymentTransfer: 14000 },
                    { type: "personal", amount: 3200,  concept: "Cigarrillos",        paymentCash: 3200,  paymentTransfer: 0     }
                ],
                ingresoUWaNX: 29431
            }
        ];

        const todayJourney = {
            date: "2026-02-17",
            kmStart: 4188,
            startWallets: { nx: 111639, mp: 29431, cash: 24100, uber: 987 },
            expenses: [
                {
                    id: Date.now() + 1,
                    type: 'fuel',
                    amount: 12000,
                    concept: 'Combustible',
                    paymentCash: 0,
                    paymentTransfer: 0,
                    paymentMP: 12000,
                    timestamp: new Date().toISOString()
                }
            ],
            incomes: [],
            uberCounter: 2097
        };

        function loadData() {
            try {
                let journeys = [];
                let kmAccumulator = 3200; // KM estimado al inicio del mes

                // Crear jornadas hist√≥ricas
                journeysData.forEach((day, index) => {
                    const isLastDay = index === journeysData.length - 1;
                    const hasRealKm = day.kmStart !== undefined;
                    const startKm = hasRealKm ? day.kmStart : kmAccumulator;
                    const endKm = hasRealKm ? day.kmEnd : (kmAccumulator + day.km);
                    
                    const startTime = new Date(day.date + 'T08:00:00').getTime();
                    const endTime = new Date(day.date + 'T20:00:00').getTime();

                    // Crear gastos
                    const expenses = [];
                    let expenseTime = startTime + 3600000;

                    // Si tiene gastos detallados (ej: 16/02), usarlos directamente
                    if (day.gastosDetalle) {
                        day.gastosDetalle.forEach((g, i) => {
                            expenses.push({
                                id: expenseTime + i,
                                type: g.type,
                                amount: g.amount,
                                concept: g.concept,
                                paymentCash: g.paymentCash,
                                paymentTransfer: g.paymentTransfer,
                                timestamp: new Date(expenseTime + i * 600000).toISOString()
                            });
                        });
                    } else {
                        if (day.combustible > 0) {
                            expenses.push({
                                id: expenseTime++,
                                type: 'fuel',
                                amount: day.combustible,
                                concept: 'Combustible',
                                paymentCash: day.combustible,
                                paymentTransfer: 0,
                                timestamp: new Date(expenseTime).toISOString()
                            });
                        }
                        if (day.gastosMoto > 0) {
                            expenses.push({
                                id: expenseTime++,
                                type: 'moto',
                                amount: day.gastosMoto,
                                concept: 'Mantenimiento/Reparaci√≥n',
                                paymentCash: day.gastosMoto * 0.6,
                                paymentTransfer: day.gastosMoto * 0.4,
                                timestamp: new Date(expenseTime).toISOString()
                            });
                        }
                        if (day.gastosPersonales > 0) {
                            expenses.push({
                                id: expenseTime++,
                                type: 'personal',
                                amount: day.gastosPersonales,
                                concept: 'Gastos del d√≠a',
                                paymentCash: day.gastosPersonales * 0.5,
                                paymentTransfer: day.gastosPersonales * 0.5,
                                timestamp: new Date(expenseTime).toISOString()
                            });
                        }
                    }

                    // Crear ingreso (recaudaci√≥n)
                    let incomeNX, incomeCash, incomeUber, incomeMP;
                    incomeMP = 0;
                    if (day.startWallets && day.endWallets) {
                        const uwaNX = day.ingresoUWaNX || 0;
                        const uwaMP = day.ingresoUWaMP || 0;
                        incomeNX   = day.endWallets.nx   - day.startWallets.nx   - uwaNX + day.gastosMoto + (day.gastosDetalle ? day.gastosDetalle.filter(g=>g.type!='fuel').reduce((s,g)=>g.paymentTransfer>0?s+g.paymentTransfer:s,0) : day.gastosPersonales * 0.5);
                        incomeCash = day.endWallets.cash  - day.startWallets.cash + (day.gastosDetalle ? day.gastosDetalle.reduce((s,g)=>g.paymentCash>0?s+g.paymentCash:s,0) : (day.gastosMoto + day.gastosPersonales) * 0.5 + day.combustible);
                        incomeUber = day.endWallets.uber  - day.startWallets.uber + uwaMP;
                        incomeMP   = uwaMP;
                    } else {
                        incomeNX   = Math.floor(day.recaudacion * 0.4);
                        incomeCash = Math.floor(day.recaudacion * 0.4);
                        incomeUber = Math.floor(day.recaudacion * 0.2);
                    }

                    const income = {
                        id: startTime + 7200000,
                        nx: incomeNX,
                        mp: incomeMP,
                        cash: incomeCash,
                        uber: incomeUber,
                        timestamp: new Date(startTime + 7200000).toISOString()
                    };

                    const journey = {
                        id: startTime,
                        startTime: new Date(startTime).toISOString(),
                        endTime: new Date(endTime).toISOString(),
                        startKm: startKm,
                        endKm: endKm,
                        kmTraveled: endKm - startKm,
                        startWallets: day.startWallets || { nx: 50000, cash: 10000, uber: 15000 },
                        endWallets:   day.endWallets   || { nx: 50000 + income.nx, cash: 10000 + income.cash, uber: 15000 + income.uber },
                        expenses: expenses,
                        incomes: [income],
                        uberCounter: day.recaudacion,
                        earnings: {
                            bruta: day.recaudacion,
                            operativa: day.recaudacion - day.combustible - day.gastosMoto,
                            neta: day.recaudacion - day.combustible - day.gastosMoto - day.gastosPersonales,
                            fuel: day.combustible,
                            moto: day.gastosMoto,
                            personal: day.gastosPersonales
                        }
                    };

                    journeys.push(journey);
                    kmAccumulator = endKm;
                });

                // Guardar jornadas
                localStorage.setItem('journeys', JSON.stringify(journeys));

                // Crear jornada activa de hoy
                const activeJourney = {
                    id: Date.now(),
                    startTime: new Date(todayJourney.date + 'T08:00:00').toISOString(),
                    startKm: todayJourney.kmStart,
                    startWallets: todayJourney.startWallets,
                    expenses: todayJourney.expenses,
                    incomes: todayJourney.incomes,
                    uberCounter: todayJourney.uberCounter
                };

                localStorage.setItem('activeJourney', JSON.stringify(activeJourney));

                // Mostrar mensaje de √©xito
                document.getElementById('successMsg').style.display = 'block';
                
                console.log('‚úÖ Historial completo cargado');
                console.log('Total de jornadas:', journeys.length);
                console.log('Jornada activa de hoy:', activeJourney);

            } catch (error) {
                alert('Error al cargar datos: ' + error.message);
                console.error(error);
            }
        }
    </script>
</body>
</html>
